<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0%25' style='stop-color:%23ff6b35'/%3E%3Cstop offset='100%25' style='stop-color:%23f7931e'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='192' height='192'/%3E%3Ccircle cx='96' cy='96' r='40' fill='%23ffd700'/%3E%3Cpath d='M0 140 Q96 100 192 140 L192 192 L0 192 Z' fill='%232c1654'/%3E%3C/svg%3E" sizes="any" type="image/svg+xml">
    <title>Alpine Sunset - Create Beautiful Sunset Visuals</title>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: 'class'
            }
        }
    </script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        [x-cloak] { display: none !important; }
        
        /* Dark mode transitions */
        * {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        /* Custom animations for theme switching */
        .theme-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        canvas {
            display: block;
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div x-data="sunsetApp()" x-init="init()" x-cloak :class="darkMode ? 'dark' : ''" class="min-h-screen bg-gradient-to-b from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-800 p-4 md:p-6 theme-transition">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="bg-gradient-to-r from-orange-500 to-pink-500 dark:from-orange-600 dark:to-pink-600 rounded-lg shadow-xl p-4 md:p-6 mb-4 md:mb-6 theme-transition">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2 flex items-center gap-2">
                            <i class="bi bi-sunset"></i>
                            Alpine Sunset
                        </h1>
                        <p class="text-orange-100 dark:text-orange-200">Create beautiful algorithmic sunset visuals</p>
                    </div>
                    <div class="flex gap-2">
                        <button @click="toggleDarkMode()" 
                                class="p-3 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-all duration-200 border border-white/30 hover:border-white/50"
                                title="Toggle dark mode"
                                :aria-label="darkMode ? 'Switch to light mode' : 'Switch to dark mode'">
                            <i x-show="!darkMode" class="bi bi-moon text-xl"></i>
                            <i x-show="darkMode" class="bi bi-sun text-xl"></i>
                        </button>
                        <button @click="randomize()" 
                                class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg flex items-center gap-2 transition-colors backdrop-blur-sm">
                            <i class="bi bi-shuffle"></i>
                            Randomize
                        </button>
                        <button @click="downloadImage()" 
                                class="px-4 py-2 bg-white hover:bg-gray-100 text-orange-600 rounded-lg flex items-center gap-2 transition-colors font-semibold">
                            <i class="bi bi-download"></i>
                            Download
                        </button>
                    </div>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
                <!-- Canvas Area (Left - 2/3 width on large screens) -->
                <div class="lg:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 md:p-6 theme-transition">
                        <canvas id="sunsetCanvas" 
                                width="1200" 
                                height="800"
                                class="w-full"></canvas>
                    </div>
                </div>

                <!-- Controls Panel (Right - 1/3 width on large screens) -->
                <div class="space-y-4">
                    <!-- Preset Selection -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-palette text-orange-500 dark:text-orange-400"></i>
                            Preset Scenes
                        </h3>
                        <select x-model="preset" 
                                @change="applyPreset()"
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 theme-transition">
                            <option value="golden-hour">Golden Hour</option>
                            <option value="twilight">Twilight</option>
                            <option value="desert-sunset">Desert Sunset</option>
                            <option value="mountain-majesty">Mountain Majesty</option>
                            <option value="ocean-dusk">Ocean Dusk</option>
                            <option value="crimson-sky">Crimson Sky</option>
                        </select>
                    </div>

                    <!-- Sky Colors -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-cloud-sun text-blue-500 dark:text-blue-400"></i>
                            Sky Colors
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Top Color</label>
                                <input type="color" 
                                       x-model="colors.skyTop" 
                                       @change="render()"
                                       class="w-full h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Middle Color</label>
                                <input type="color" 
                                       x-model="colors.skyMiddle" 
                                       @change="render()"
                                       class="w-full h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Horizon Color</label>
                                <input type="color" 
                                       x-model="colors.skyBottom" 
                                       @change="render()"
                                       class="w-full h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                            </div>
                        </div>
                    </div>

                    <!-- Sun/Moon -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-brightness-high text-yellow-500 dark:text-yellow-400"></i>
                            Sun/Moon
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Position Y: <span x-text="sun.y"></span>%
                                </label>
                                <input type="range" 
                                       x-model="sun.y" 
                                       @input="render()"
                                       min="10" 
                                       max="70" 
                                       class="w-full">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Size: <span x-text="sun.size"></span>
                                </label>
                                <input type="range" 
                                       x-model="sun.size" 
                                       @input="render()"
                                       min="40" 
                                       max="150" 
                                       class="w-full">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Color</label>
                                <input type="color" 
                                       x-model="sun.color" 
                                       @change="render()"
                                       class="w-full h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Glow Intensity: <span x-text="sun.glow"></span>
                                </label>
                                <input type="range" 
                                       x-model="sun.glow" 
                                       @input="render()"
                                       min="0" 
                                       max="100" 
                                       class="w-full">
                            </div>
                        </div>
                    </div>

                    <!-- Mountains -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-triangle text-purple-500 dark:text-purple-400"></i>
                            Mountains
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" 
                                           x-model="mountains.enabled" 
                                           @change="render()"
                                           class="w-4 h-4 text-orange-500">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Show Mountains</span>
                                </label>
                            </div>
                            <div x-show="mountains.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Layers: <span x-text="mountains.layers"></span>
                                </label>
                                <input type="range" 
                                       x-model="mountains.layers" 
                                       @input="render()"
                                       min="1" 
                                       max="5" 
                                       class="w-full">
                            </div>
                            <div x-show="mountains.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Height: <span x-text="mountains.height"></span>%
                                </label>
                                <input type="range" 
                                       x-model="mountains.height" 
                                       @input="render()"
                                       min="20" 
                                       max="60" 
                                       class="w-full">
                            </div>
                            <div x-show="mountains.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Base Color</label>
                                <input type="color" 
                                       x-model="mountains.color" 
                                       @change="render()"
                                       class="w-full h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                            </div>
                        </div>
                    </div>

                    <!-- Clouds -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-cloud text-gray-500 dark:text-gray-400"></i>
                            Clouds
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" 
                                           x-model="clouds.enabled" 
                                           @change="render()"
                                           class="w-4 h-4 text-orange-500">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Show Clouds</span>
                                </label>
                            </div>
                            <div x-show="clouds.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Density: <span x-text="clouds.density"></span>
                                </label>
                                <input type="range" 
                                       x-model="clouds.density" 
                                       @input="render()"
                                       min="5" 
                                       max="20" 
                                       class="w-full">
                            </div>
                            <div x-show="clouds.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Opacity: <span x-text="clouds.opacity"></span>%
                                </label>
                                <input type="range" 
                                       x-model="clouds.opacity" 
                                       @input="render()"
                                       min="10" 
                                       max="80" 
                                       class="w-full">
                            </div>
                        </div>
                    </div>

                    <!-- Stars -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 theme-transition">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-star text-yellow-400 dark:text-yellow-300"></i>
                            Stars
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="flex items-center gap-2">
                                    <input type="checkbox" 
                                           x-model="stars.enabled" 
                                           @change="render()"
                                           class="w-4 h-4 text-orange-500">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Show Stars</span>
                                </label>
                            </div>
                            <div x-show="stars.enabled">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Count: <span x-text="stars.count"></span>
                                </label>
                                <input type="range" 
                                       x-model="stars.count" 
                                       @input="render()"
                                       min="0" 
                                       max="200" 
                                       class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function sunsetApp() {
            return {
                // === STATE ===
                canvas: null,
                ctx: null,
                preset: 'golden-hour',
                darkMode: false,
                
                colors: {
                    skyTop: '#1a1a3e',
                    skyMiddle: '#ff6b35',
                    skyBottom: '#ffd700'
                },
                
                sun: {
                    y: 45,
                    size: 80,
                    color: '#ffd700',
                    glow: 50
                },
                
                mountains: {
                    enabled: true,
                    layers: 3,
                    height: 40,
                    color: '#2c1654'
                },
                
                clouds: {
                    enabled: true,
                    density: 10,
                    opacity: 40
                },
                
                stars: {
                    enabled: false,
                    count: 50
                },
                
                starPositions: [],
                
                // === LIFECYCLE ===
                init() {
                    this.canvas = document.getElementById('sunsetCanvas');
                    this.ctx = this.canvas.getContext('2d');
                    this.generateStars();
                    this.loadDarkModePreference();
                    this.loadFromStorage();
                    this.render();
                },
                
                // === DARK MODE METHODS ===
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.updateDarkMode();
                    this.saveDarkModePreference();
                },

                updateDarkMode() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },

                loadDarkModePreference() {
                    const saved = localStorage.getItem('alpine-sunset-darkMode');
                    if (saved !== null) {
                        this.darkMode = saved === 'true';
                    } else {
                        // Detect system preference
                        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                            this.darkMode = true;
                        }
                    }
                    this.updateDarkMode();
                },

                saveDarkModePreference() {
                    localStorage.setItem('alpine-sunset-darkMode', this.darkMode.toString());
                },
                
                // === PRESET METHODS ===
                applyPreset() {
                    const presets = {
                        'golden-hour': {
                            colors: {
                                skyTop: '#1a1a3e',
                                skyMiddle: '#ff6b35',
                                skyBottom: '#ffd700'
                            },
                            sun: { y: 45, size: 80, color: '#ffd700', glow: 50 },
                            mountains: { enabled: true, layers: 3, height: 40, color: '#2c1654' },
                            clouds: { enabled: true, density: 10, opacity: 40 },
                            stars: { enabled: false, count: 50 }
                        },
                        'twilight': {
                            colors: {
                                skyTop: '#0a0a1e',
                                skyMiddle: '#6b35ff',
                                skyBottom: '#ff6b9d'
                            },
                            sun: { y: 65, size: 60, color: '#ff6b9d', glow: 30 },
                            mountains: { enabled: true, layers: 4, height: 35, color: '#1a0a2e' },
                            clouds: { enabled: true, density: 8, opacity: 30 },
                            stars: { enabled: true, count: 100 }
                        },
                        'desert-sunset': {
                            colors: {
                                skyTop: '#d4422e',
                                skyMiddle: '#f7931e',
                                skyBottom: '#ffeb3b'
                            },
                            sun: { y: 40, size: 100, color: '#ff5722', glow: 70 },
                            mountains: { enabled: true, layers: 2, height: 25, color: '#8b4513' },
                            clouds: { enabled: false, density: 5, opacity: 20 },
                            stars: { enabled: false, count: 0 }
                        },
                        'mountain-majesty': {
                            colors: {
                                skyTop: '#2c3e50',
                                skyMiddle: '#e74c3c',
                                skyBottom: '#f39c12'
                            },
                            sun: { y: 50, size: 70, color: '#e67e22', glow: 40 },
                            mountains: { enabled: true, layers: 5, height: 50, color: '#34495e' },
                            clouds: { enabled: true, density: 12, opacity: 50 },
                            stars: { enabled: false, count: 30 }
                        },
                        'ocean-dusk': {
                            colors: {
                                skyTop: '#34495e',
                                skyMiddle: '#9b59b6',
                                skyBottom: '#3498db'
                            },
                            sun: { y: 60, size: 90, color: '#e67e22', glow: 60 },
                            mountains: { enabled: false, layers: 1, height: 20, color: '#2c3e50' },
                            clouds: { enabled: true, density: 15, opacity: 35 },
                            stars: { enabled: true, count: 80 }
                        },
                        'crimson-sky': {
                            colors: {
                                skyTop: '#4a0000',
                                skyMiddle: '#c0392b',
                                skyBottom: '#e74c3c'
                            },
                            sun: { y: 35, size: 120, color: '#e74c3c', glow: 80 },
                            mountains: { enabled: true, layers: 3, height: 45, color: '#1a0a0e' },
                            clouds: { enabled: true, density: 18, opacity: 60 },
                            stars: { enabled: false, count: 20 }
                        }
                    };
                    
                    const presetData = presets[this.preset];
                    if (presetData) {
                        this.colors = { ...presetData.colors };
                        this.sun = { ...presetData.sun };
                        this.mountains = { ...presetData.mountains };
                        this.clouds = { ...presetData.clouds };
                        this.stars = { ...presetData.stars };
                        this.generateStars();
                        this.render();
                        this.saveToStorage();
                    }
                },
                
                randomize() {
                    // Random colors
                    this.colors.skyTop = this.randomColor(['#1a1a3e', '#0a0a1e', '#2c3e50', '#4a0000', '#34495e']);
                    this.colors.skyMiddle = this.randomColor(['#ff6b35', '#6b35ff', '#e74c3c', '#c0392b', '#9b59b6', '#f7931e']);
                    this.colors.skyBottom = this.randomColor(['#ffd700', '#ff6b9d', '#f39c12', '#e74c3c', '#3498db', '#ffeb3b']);
                    
                    // Random sun
                    this.sun.y = Math.floor(Math.random() * 40) + 25;
                    this.sun.size = Math.floor(Math.random() * 80) + 60;
                    this.sun.color = this.randomColor(['#ffd700', '#ff5722', '#e67e22', '#e74c3c']);
                    this.sun.glow = Math.floor(Math.random() * 60) + 30;
                    
                    // Random mountains
                    this.mountains.enabled = Math.random() > 0.3;
                    this.mountains.layers = Math.floor(Math.random() * 4) + 2;
                    this.mountains.height = Math.floor(Math.random() * 30) + 25;
                    this.mountains.color = this.randomColor(['#2c1654', '#1a0a2e', '#34495e', '#8b4513', '#2c3e50', '#1a0a0e']);
                    
                    // Random clouds
                    this.clouds.enabled = Math.random() > 0.4;
                    this.clouds.density = Math.floor(Math.random() * 12) + 8;
                    this.clouds.opacity = Math.floor(Math.random() * 40) + 30;
                    
                    // Random stars
                    this.stars.enabled = Math.random() > 0.5;
                    this.stars.count = Math.floor(Math.random() * 150) + 50;
                    
                    this.generateStars();
                    this.render();
                    this.saveToStorage();
                },
                
                randomColor(options) {
                    return options[Math.floor(Math.random() * options.length)];
                },
                
                // === RENDERING METHODS ===
                render() {
                    const w = this.canvas.width;
                    const h = this.canvas.height;
                    
                    // Clear canvas
                    this.ctx.clearRect(0, 0, w, h);
                    
                    // Draw sky gradient
                    this.drawSky(w, h);
                    
                    // Draw stars (if enabled and before sun for layering)
                    if (this.stars.enabled) {
                        this.drawStars(w, h);
                    }
                    
                    // Draw sun with glow
                    this.drawSun(w, h);
                    
                    // Draw clouds
                    if (this.clouds.enabled) {
                        this.drawClouds(w, h);
                    }
                    
                    // Draw mountains
                    if (this.mountains.enabled) {
                        this.drawMountains(w, h);
                    }
                    
                    this.saveToStorage();
                },
                
                drawSky(w, h) {
                    const gradient = this.ctx.createLinearGradient(0, 0, 0, h);
                    gradient.addColorStop(0, this.colors.skyTop);
                    gradient.addColorStop(0.5, this.colors.skyMiddle);
                    gradient.addColorStop(1, this.colors.skyBottom);
                    
                    this.ctx.fillStyle = gradient;
                    this.ctx.fillRect(0, 0, w, h);
                },
                
                drawSun(w, h) {
                    const sunX = w / 2;
                    const sunY = (h * this.sun.y) / 100;
                    const sunRadius = parseInt(this.sun.size);
                    
                    // Draw glow
                    if (this.sun.glow > 0) {
                        const glowRadius = sunRadius * (1 + this.sun.glow / 100);
                        const glowGradient = this.ctx.createRadialGradient(sunX, sunY, sunRadius, sunX, sunY, glowRadius);
                        glowGradient.addColorStop(0, this.sun.color + 'aa');
                        glowGradient.addColorStop(0.5, this.sun.color + '44');
                        glowGradient.addColorStop(1, this.sun.color + '00');
                        
                        this.ctx.fillStyle = glowGradient;
                        this.ctx.beginPath();
                        this.ctx.arc(sunX, sunY, glowRadius, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                    
                    // Draw sun
                    this.ctx.fillStyle = this.sun.color;
                    this.ctx.beginPath();
                    this.ctx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                },
                
                drawMountains(w, h) {
                    const layers = parseInt(this.mountains.layers);
                    const baseHeight = (h * this.mountains.height) / 100;
                    
                    for (let layer = 0; layer < layers; layer++) {
                        const opacity = 1 - (layer / layers) * 0.5;
                        const heightMultiplier = 1 - (layer / layers) * 0.3;
                        const mountainHeight = baseHeight * heightMultiplier;
                        
                        this.ctx.fillStyle = this.mountains.color + Math.round(opacity * 255).toString(16).padStart(2, '0');
                        this.ctx.beginPath();
                        this.ctx.moveTo(0, h);
                        
                        // Create mountain peaks
                        const peaks = 3 + layer;
                        for (let i = 0; i <= peaks; i++) {
                            const x = (w / peaks) * i;
                            const peakHeight = h - mountainHeight - (Math.random() * 50 + 50) * (layer === 0 ? 1.5 : 1);
                            this.ctx.lineTo(x, peakHeight);
                            
                            if (i < peaks) {
                                const valleyX = x + (w / peaks) / 2;
                                const valleyHeight = h - mountainHeight * 0.6 - Math.random() * 30;
                                this.ctx.lineTo(valleyX, valleyHeight);
                            }
                        }
                        
                        this.ctx.lineTo(w, h);
                        this.ctx.closePath();
                        this.ctx.fill();
                    }
                },
                
                drawClouds(w, h) {
                    const cloudCount = parseInt(this.clouds.density);
                    const opacity = this.clouds.opacity / 100;
                    
                    // Use deterministic cloud positions based on density
                    for (let i = 0; i < cloudCount; i++) {
                        const x = (w / cloudCount) * i + (Math.sin(i * 100) * 100);
                        const y = (h * 0.2) + (Math.cos(i * 50) * h * 0.15);
                        const cloudWidth = 100 + (Math.sin(i * 75) * 80);
                        const cloudHeight = 40 + (Math.cos(i * 60) * 20);
                        
                        this.drawCloud(x, y, cloudWidth, cloudHeight, opacity);
                    }
                },
                
                drawCloud(x, y, width, height, opacity) {
                    this.ctx.save();
                    this.ctx.globalAlpha = opacity;
                    this.ctx.fillStyle = '#ffffff';
                    
                    // Draw cloud using multiple circles
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, height, 0, Math.PI * 2);
                    this.ctx.arc(x + width * 0.3, y - height * 0.3, height * 0.8, 0, Math.PI * 2);
                    this.ctx.arc(x + width * 0.6, y, height * 0.9, 0, Math.PI * 2);
                    this.ctx.arc(x + width * 0.8, y - height * 0.2, height * 0.7, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    this.ctx.restore();
                },
                
                generateStars() {
                    this.starPositions = [];
                    const count = parseInt(this.stars.count);
                    
                    for (let i = 0; i < count; i++) {
                        this.starPositions.push({
                            x: Math.random(),
                            y: Math.random() * 0.5, // Only in top half
                            size: Math.random() * 2 + 0.5,
                            brightness: Math.random() * 0.5 + 0.5
                        });
                    }
                },
                
                drawStars(w, h) {
                    this.ctx.fillStyle = '#ffffff';
                    
                    this.starPositions.forEach(star => {
                        const x = star.x * w;
                        const y = star.y * h;
                        
                        this.ctx.globalAlpha = star.brightness;
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, star.size, 0, Math.PI * 2);
                        this.ctx.fill();
                    });
                    
                    this.ctx.globalAlpha = 1;
                },
                
                // === EXPORT METHODS ===
                downloadImage() {
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    link.download = `alpine-sunset-${timestamp}.png`;
                    link.href = this.canvas.toDataURL('image/png');
                    link.click();
                },
                
                // === STORAGE METHODS ===
                saveToStorage() {
                    const state = {
                        preset: this.preset,
                        colors: this.colors,
                        sun: this.sun,
                        mountains: this.mountains,
                        clouds: this.clouds,
                        stars: this.stars
                    };
                    localStorage.setItem('alpine-sunset-state', JSON.stringify(state));
                },
                
                loadFromStorage() {
                    const saved = localStorage.getItem('alpine-sunset-state');
                    if (saved) {
                        try {
                            const state = JSON.parse(saved);
                            this.preset = state.preset || this.preset;
                            this.colors = { ...this.colors, ...state.colors };
                            this.sun = { ...this.sun, ...state.sun };
                            this.mountains = { ...this.mountains, ...state.mountains };
                            this.clouds = { ...this.clouds, ...state.clouds };
                            this.stars = { ...this.stars, ...state.stars };
                            this.generateStars();
                        } catch (error) {
                            console.error('Error loading saved state:', error);
                        }
                    }
                }
            };
        }
    </script>

    <!-- PWA Implementation -->
    <script>
        // PWA install prompt handling
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA Install prompt available!');
            // Uncomment to capture and defer the prompt
            // e.preventDefault();
            // window.deferredPrompt = e;
        });

        const iconSize = 192;

        // Dynamically created manifest
        const manifest = {
            name: 'Alpine Sunset - Sunset Visual Creator',
            short_name: 'Alpine Sunset',
            display: 'standalone',
            theme_color: '#ff6b35',
            background_color: '#1a1a2e',
            start_url: window.location.href,
        };

        // Convert the SVG favicon to PNG for platforms that don't support SVG
        (async function() {
            const svgIconLink = document.querySelector('link[rel="icon"]');

            // Convert from SVG string to PNG data URL
            const pngDataUrl = await svgToPng(svgIconLink.href, iconSize);

            // Set the icon meta tags to the new PNG
            setIcon("link[rel='icon']", pngDataUrl, iconSize);
            setIcon("link[rel='apple-touch-icon']", pngDataUrl);

            // Dynamically create manifest
            manifest.icons = [{
                src: pngDataUrl,
                sizes: `${iconSize}x${iconSize}`,
                type: 'image/png',
                purpose: 'any'
            }];

            // Generate iOS startup images for different device sizes
            const startupImages = await generateiOSStartupImages(pngDataUrl, manifest.background_color);
            
            // Inject manifest as data URL
            const manifestJson = JSON.stringify(manifest);
            const manifestDataUrl = `data:application/manifest+json,${encodeURIComponent(manifestJson)}`;
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = manifestDataUrl;
            document.head.appendChild(manifestLink);
        })();

        function setIcon(selector, dataUrl, size = null) {
            const element = document.querySelector(selector);
            if (element) {
                element.href = dataUrl;
                if (size && selector.includes('icon')) {
                    element.sizes = `${size}x${size}`;
                }
            }
        }

        async function generateiOSStartupImages(iconDataUrl, bgColor) {
            const sizes = [
                { width: 1125, height: 2436, media: '(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)' },
                { width: 1242, height: 2688, media: '(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)' }
            ];

            for (const size of sizes) {
                const startupImageUrl = await createStartupImage(iconDataUrl, size.width, size.height, bgColor);
                
                const link = document.createElement('link');
                link.rel = 'apple-touch-startup-image';
                link.href = startupImageUrl;
                link.media = size.media;
                document.head.appendChild(link);
            }
        }

        async function createStartupImage(iconDataUrl, width, height, bgColor) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                const img = new Image();
                img.onload = () => {
                    const iconDisplaySize = canvas.width * 0.25;
                    const x = (canvas.width - iconDisplaySize) / 2;
                    const y = (canvas.height - iconDisplaySize) / 2;
                    ctx.drawImage(img, x, y, iconDisplaySize, iconDisplaySize);

                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = reject;
                img.src = iconDataUrl;
            });
        }

        async function svgToPng(svgDataUrl, size) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');

                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0, size, size);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = reject;
                img.src = svgDataUrl;
            });
        }
    </script>
</body>
</html>
